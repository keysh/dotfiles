#!/usr/bin/env node

const https = require('https');

const fiat   = 'EUR';
const crypto = ['BTC', 'ETH', 'LTC', 'XMR'];

function createOptions(base, target) {
    return {
        host:   'api.cryptonator.com',
        path:   `/api/ticker/${base}-${target}`,
        port:   443,
        method: 'GET'
    };
}

function processRequest(response) {
    let data = '';

    response.setEncoding('utf8');
    response.on('data', (chunk) => data += chunk);
    response.on('end', () => parseData(data));
}

function parseData(data) {
    const info   = JSON.parse(data);
    const base   = info.ticker.base;
    const target = info.ticker.target;
    const price  = parseFloat(info.ticker.price).toFixed(2)

    console.log(`1 ${info.ticker.base} = ${price} ${target}`);
}

crypto.forEach((currency) => {
    const request = https.request(
        createOptions(currency, fiat), 
        (response) => processRequest(response, fiat, currency)
    );

    request.on('error', (error) => console.error(`ERROR: ${error}`));
    request.end();
});
